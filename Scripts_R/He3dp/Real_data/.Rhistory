#        obsy[i] ~ dlnorm(yt[i], pow(tau,-2))
#        yt[i] <- log(mu[i]) - 0.5*log(1+(pow(tau/mu[i],2)))
#        mu[i] <- sfactor3Hedp(obsx[i], e1, gin, gout)
# MCMC solution via JAGS
model.data <- list(Y = y,               # Response variable
X = lambda,          # Predictors
N = nobs,             # Sample size
h =  4.135e-15, #erg.s
pi = 3.141592654,
c = 2.997e10 * 1e4,#cm/s
k = 8.6173303e-5
)
# Model set up
NORM <- "model{
# Uniform prior for standard deviation
tau ~ dgamma(0.01,0.01)
# Prior for temperature
Temp ~ dgamma(0.01,0.01)
# Likelihood function
for (i in 1:N){
Y[i] ~ dlnorm(muL[i],pow(tau,-2))
muL[i] <- log(eta[i]) - 0.5*log(1+(pow(tau/eta[i],2)))
eta[i] <- (8*pi*h*c/pow(X[i],5))*1/(exp(h*c/(k*Temp*X[i])) - 1)
}
}"
# Initial values
inits <- function () {list(
Temp = runif(1,1e2,1e4))
}
# Parameters to be displayed
params <- c("Temp", "tau","eta")
# MCMC
normfit <- jags(data = model.data,
inits = inits,
parameters = params,
model = textConnection(NORM),
n.chains = 3,
n.iter = 10000,
n.thin = 10,
n.burnin = 5000)
print(normfit, intervals = c(0.025, 0.975), digits = 2)
jagsresults(x=normfit , params=c('Temp'),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
y <- jagsresults(x=normfit , params=c('eta'),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
xx <- lambda
gdata <- data.frame(x =xx, mean = y[,"mean"],lwr1=y[,"25%"],lwr2=y[,"2.5%"],lwr3=y[,"0.5%"],upr1=y[,"75%"],
upr2=y[,"97.5%"],upr3=y[,"99.5%"])
gobs <- data.frame(lambda,mu)
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "orange3",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="purple",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "cyan",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="purple",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "yellow",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="purple",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "red",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="purple",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="purple",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,")",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength(",mu,"m)",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength[",mu,"m]",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength/,mu"]",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength/",mu,sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength/",mu,"m",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength",mu,"m",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength",(mu),"m",sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(expression(paste("Wavelength",(mu,"m",),sep=""))) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
require(latex2exp)
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\\(mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$(\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\(\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\left(\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\\left(\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength($\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength($\lbrack\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\lbrack\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$\\lbrack\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('Wavelength$ \\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
ggplot(gobs,aes(x=lambda,y=mu))+
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.7,fill=c("gray70"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL), fill = "#5DADE2",show.legend=FALSE) +
#  geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.4,fill=c("gray30"),show.legend=FALSE) +
geom_point(color="#F1948A",size=2)+
geom_line(data=gdata,aes(x=xx,y=mean),linetype="dashed",size=0.5,show.legend=FALSE) +
theme_xkcd() +
xlab(TeX('$\\mu m$')) +
ylab(expression(B[lambda])) +
theme(panel.background = element_rect(color = "black", fill = "gray85") )
normfit
as.matrix(normfit)
as.mcmc(normfit)
13.4*350
13.4*400
13.4*340
13.4*350
13.4*380
3*380
3*320
3*318
13.4*340
3*320
3*310
5*5
400*13.4279
350*13.4279
315*13.4279
4699.765/4229.788
4699.765-4229.788
260*13.4279
4.243-3491
4243-3491
setwd("~/Documents/GitHub/JAGS_UNC/Scripts_R/He3dp/Real_data")
# 3Hedp analysis
#
# purpose: Real  DATA
#
# - 3 parameters are assumed: Er, gamma_d^2, gamma_n^2 [e1, gin, gout]
#
# - uses the function sfactorTdn_fast(obsx1[i], e1, gin, gout), which
#   is a C++ version of a Fortran code that includes Coulomb wave
#   function calculations; JAGS has been recompiled with this C++ function
#
######################################################################
# preparation: remove all variables from the work space
rm(list=ls())
set.seed(123)
######################################################################
# data input
# format: obsx, obsy, errobsy; the latter are the individual statistical
# errors of each datum [i]
#
# energy is in units of MeV, and the S-factor in MeVb;
######################################################################
# import packages
library(rjags);library(R2jags);library(mcmcplots)
require(RcppGSL);require(ggplot2);require(ggthemes)
require(nuclear);library(magrittr)
library(dplyr);require(ggsci);require(ggmcmc);require(plyr);library(latex2exp)
source("/Users/Rafael/Documents/GitHub/JAGS_UNC/Scripts_R/auxiliar_functions/jagsresults.R")
## for block updating [we do not need to center predictor variables]
load.module("glm")
load.module("nuclear")
######################################################################
## Read DATA GENERATION
#ensamble <- read.csv("ensamble.csv",header = T,stringsAsFactors=FALSE)  %>%
#  mutate(Stat=replace(Stat,Stat==0,0.1)) %>%
#  mutate(dat=replace(dat,dat %in% c("gei99b","gei99d"),"Gei99")) %>%
#  mutate(dat=replace(dat,dat %in% c("Kra87m","Kra87b"),"Kra87")) %>%
#  mutate(dat=replace(dat,dat == "zhi77b","Zhi77")) %>%
# filter(.,dat!="Lac05")  %>% droplevels(.) %>%
# mutate(dat=as.factor(dat))
ensamble <- read.csv("ensamble.csv",header = T) %>%
mutate(Syst=replace(Syst,Syst==0.06,0.078))
re <- as.numeric(ensamble$dat)
Nre <- length(unique(ensamble$dat))
ik <- as.numeric(ensamble$invK)
Nik <- length(unique(ensamble$invK))
# Radius
# r_i = 6
# r_f = 5
# Literature
#  0.35779   # resonance energy
#  1.0085    # reduced width incoming
#  0.025425   # reduced width outgoing
N <- nrow(ensamble)
obsy <- ensamble$S    # Response variable
obsx <-  ensamble$E   # Predictors
erry <- ensamble$Stat
set <- ensamble$dat
lab <- ensamble$invK
syst = c(0.03,unique(ensamble$Syst))
#syst <- syst[-3]
M <- 500
xx <- seq(min(obsx),max(obsx),length.out = M)
model.data <- list(obsy = obsy,    # Response variable
obsx =  obsx,   # Predictors
erry = erry,
N = nrow(ensamble), # Sample size
syst = syst,
Nre = Nre,
re = re,
Nik = Nik,
ik  = ik,
M = M,
xx = xx
)
######################################################################
Model <- "model{
# LIKELIHOOD
for (i in 1:N) {
obsy[i] ~ dnorm(y[i], pow(erry[i], -2))
y[i] ~ dnorm(scale[re[i]]*sfactor3Hedp(obsx[i], e1, gin, gout,ri,rf,ue[ik[i]]),pow(tau, -2))
#y[i] <- scale[re[i]]*sfactor3Hedp(obsx[i], e1, gin, gout)
}
# Predicted values
for (j in 1:M){
# Bare...
mux0[j] <- sfactor3Hedp(xx[j], e1, gin, gout,ri,rf,0)
yx0[j] ~ dnorm(mux0[j],pow(tau,-2))
# No inverse Kinematics
mux1[j] <- sfactor3Hedp(xx[j], e1, gin, gout,ri,rf,ue[1])
yx1[j] ~ dnorm(mux1[j],pow(tau,-2))
# With inverse Kinematics
mux2[j] <- sfactor3Hedp(xx[j], e1, gin, gout,ri,rf,ue[2])
yx2[j] ~ dnorm(mux1[j],pow(tau,-2))
}
for (k in 1:Nre){
scale[k] ~ dlnorm(log(1.0),pow(log(1+syst[k]),-2))
}
for (z in 1:Nik){
ue[z] ~ dunif(0,1e-3)
}
# PRIORS
# e1, gin, gout are defined as in tdn.f (by Alain Coc):
# resonance energy, initial reduced width, final reduced
# width;
tau ~  dgamma(0.01,0.01)
e1 ~   dnorm(0,0.01)T(0,)
gin ~ dnorm(0,0.01)T(0,)
gout ~ dbeta(2,5)
ri ~ ddexp(5,10)
rf ~ ddexp(4,10)
#gb ~ dbeta(2,2)
#gin ~ dunif(0,20)
#gout ~ dbeta(2,5)
# Channel radius
#  rb ~ dbeta(2,2)
#  rb2 ~ dbeta(2,2)
#  ri <- 4*rb + 3
#  rf <- 4*rb2 + 3
}"
######################################################################
# n.adapt:  number of iterations in the chain for adaptation (n.adapt)
#           [JAGS will use to choose the sampler and to assure optimum
#           mixing of the MCMC chain; will be discarded]
# n.udpate: number of iterations for burnin; these will be discarded to
#           allow the chain to converge before iterations are stored
# n.iter:   number of iterations to store in the final chain as samples
#           from the posterior distribution
# n.chains: number of mcmc chains
# n.thin:   store every n.thin element [=1 keeps all samples]
inits <- function () { list(e1 = runif(1,0.15,1),gout=runif(1,0.01,1)) }
# "f": is the model specification from above;
# data = list(...): define all data elements that are referenced in the
# JAGS model with R2Jags;
Normfit <- jags(data = model.data,
inits = inits,
parameters = c("e1", "gin", "gout","ue","tau", "ri","rf","mux0","mux1","mux2","scale"),
model = textConnection(Model),
n.thin = 1,
n.chains = 3,
n.burnin = 3000,
n.iter = 6000)
jagsresults(x=Normfit , params=c("e1", "gin", "gout","ue","tau","ri","rf"),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
y <- jagsresults(x=Normfit , params=c('mux1'),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
x <- xx
gdata <- data.frame(x =xx, mean = y[,"mean"],lwr1=y[,"25%"],lwr2=y[,"2.5%"],lwr3=y[,"0.5%"],upr1=y[,"75%"],
upr2=y[,"97.5%"],upr3=y[,"99.5%"])
gobs <- data.frame(obsx,obsy,erry,set,lab)
gobs$set <- as.factor(gobs$set)
y2 <- jagsresults(x=Normfit , params=c('mux2'),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
gdata2 <- data.frame(x =xx, mean = y2[,"mean"],lwr1=y2[,"25%"],lwr2=y2[,"2.5%"],lwr3=y2[,"0.5%"],upr1=y2[,"75%"],
upr2=y2[,"97.5%"],upr3=y2[,"99.5%"])
y0 <- jagsresults(x=Normfit , params=c('mux0'),probs=c(0.005,0.025, 0.25, 0.5, 0.75, 0.975,0.995))
gdata0 <- data.frame(x =xx, mean = y0[,"mean"],lwr1=y0[,"25%"],lwr2=y0[,"2.5%"],lwr3=y0[,"0.5%"],upr1=y0[,"75%"],
upr2=y0[,"97.5%"],upr3=y0[,"99.5%"])
ggplot(gobs,aes(x=obsx,y=obsy))+
geom_rect(aes(xmin=0.045, xmax=0.356, ymin=0, ymax=20), fill="snow",alpha=0.2) +
#
geom_ribbon(data=gdata0,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.8,fill=c("#f0f0f0"),show.legend=FALSE)+
geom_ribbon(data=gdata0,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL),alpha=0.7,  fill = c("#bdbdbd"),show.legend=FALSE) +
geom_ribbon(data=gdata0,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.6,fill=c("#636363"),show.legend=FALSE) +
#
geom_ribbon(data=gdata2,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.8,fill=c("#fee8c8"),show.legend=FALSE)+
geom_ribbon(data=gdata2,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL),alpha=0.7,  fill = c("#fdbb84"),show.legend=FALSE) +
geom_ribbon(data=gdata2,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.6,fill=c("#e34a33"),show.legend=FALSE) +
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr3, ymax=upr3,y= NULL),alpha=0.8,fill=c("#deebf7"),show.legend=FALSE)+
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr2, ymax=upr2,y=NULL),alpha=0.7,  fill = c("#9ecae1"),show.legend=FALSE) +
geom_ribbon(data=gdata,aes(x=xx,ymin=lwr1, ymax=upr1,y=NULL),alpha=0.6,fill=c("#3182bd"),show.legend=FALSE) +
#
geom_point(data=gobs,aes(x=obsx,y=obsy,group=set,color=lab,shape=set),size=2.5)+
geom_errorbar(show.legend=FALSE,data=gobs,aes(x=obsx,y=obsy,ymin=obsy-erry,ymax=obsy+erry,group=lab,color=lab),
width=0.01,alpha=0.4)+
geom_line(data=gdata,aes(x=xx,y=mean),colour="white",linetype="dashed",size=0.75,show.legend=FALSE)+
geom_line(data=gdata2,aes(x=xx,y=mean),colour="white",linetype="dashed",size=0.75,show.legend=FALSE)+
#  scale_colour_manual(values=c("#0101fd","#ff0101"),name="Inverse Kinematics")+
scale_colour_stata(name="Inverse Kinematics")+
scale_shape_manual(values=c(0,1,2,5,25,11,13),name="")+
coord_cartesian(xlim=c(5e-3,0.85),ylim=c(0,20)) +
theme_bw() + xlab("Energy (MeV)") + ylab("S-Factor (MeV b)") +
scale_x_log10()  +
annotation_logticks(sides = "b") +
annotation_logticks(base=2.5,sides = "l") +
theme(legend.position = "top",
legend.background = element_rect(colour = "white", fill = "white"),
plot.background = element_rect(colour = "white", fill = "white"),
panel.background = element_rect(colour = "white", fill = "white"),
legend.key = element_rect(colour = "white", fill = "white"),
axis.title = element_text(color="#666666", face="bold", size=17.5),
axis.text  = element_text(size=10),
strip.text = element_text(size=10),
strip.background = element_rect("gray85"))
